doctype html
html
    head
        link(href="/assets/css/mobile/reset.css" rel="stylesheet" type="text/css")
        link(href="/assets/css/mobile/ui.css" rel="stylesheet" type="text/css")
        link(href="/assets/css/mobile/h5-3/brand.css",rel="stylesheet",type="text/css")
        title brand
        meta(name="viewport",content="width=device-width, initial-scale=1, maximum-scale=1")
        script(src="/assets/js/lib/jquery-2.1.1.min.js")
    body
        #brand-list
            //- .brand-num
            //-     h2 拼音选品牌
            //-     ul.list
            //-         li
            //-             a(href="#") a
            //-         li
            //-             a(href="") b
            //-         li
            //-             a(href="") c
            //-         li
            //-             a(href="") d
            //-         li
            //-             a(href="") e
            //-         li
            //-             a(href="") f
            //-         li
            //-             a(href="") g
            //-         li
            //-             a(href="") h
            //- .brand-item
            //-     .title A
            //-     ul.list
            //-         li.item 
            //-             img(src="", alt="")
            //-             span 奥迪
            //-             .sub
            //-                 .car 
            //-                     span 全部车系
            //-                 .car-cat 一汽奥迪
            //-                 .car 
            //-                     span 奥迪A3
            //-                     span 奥迪A3 
            //-                     span 奥迪A3 
            //-                     span 奥迪A3  
            //-                 .car-cat 进口奥迪
            //-                 .car    
            //-                     span 奥迪A3 
            //-                     span 奥迪A3 
            //-                     span 奥迪A3 
            //-                     span 奥迪A3 
            //-         li.item 
            //-             img(src="", alt="")
            //-             span 奥迪
            //-             //- .sub
            //-         li.item 
            //-             img(src="", alt="")
            //-             span 奥迪
            //-             //- .sub
            //-         li.item 
            //-             img(src="", alt="")
            //-             span 奥迪
            //-             //- .sub
            //-         li.item 
            //-             img(src="", alt="")
            //-             span 奥迪
            //-             //- .sub
            //-         li.item 
            //-             img(src="", alt="")
            //-             span 奥迪
            //-             //- .sub
            //-         li.item 
            //-             img(src="", alt="")
            //-             span 奥迪
            //-             //- .sub
            //-         li.item 
            //-             img(src="", alt="")
            //-             span 奥迪
            //-             //- .sub
            //-         li.item 
            //-             img(src="", alt="")
            //-             span 奥迪
                        //- .sub
    script.
        //- var brandUrl = contextPath + '/pages/dicAction/loadRootLevel.json?type=car-subdivision';
        
        var _view = {
            buildNum: function(arr) {
                var brandNum = '<div class="brand-num"><h2>拼音选品牌</h2><ul class="list">';
                var i,
                    len = arr.length;
                for (i = 0; i < len; i++) {
                    brandNum += '<li><a href="#brand' + arr[i] + '">' + arr[i] + '</a></li>'
                }

                brandNum += '</ul></div>';

                return brandNum;
            },


            buildItem: function(arr) {
                var buildItem = '';
                var i;
                var len = arr.length;
                var rowItem = 4;
                for (var p in arr) {
                    buildItem += '<div class="brand-item"><div class="title" id="brand' + p 
                                + '">' + p + '</div>';
                    for (var i = 0; i < arr[p].length; i++) {
                        if (i % rowItem == 0) {
                            buildItem += '<ul class="list">';
                        }
                        buildItem += '<li class="item" data-code="' + arr[p][i].code 
                                    + '"><img src="http://res.souche.com/files/carproduct/brand/' 
                                    +  arr[p][i].code +'.png"><span>' 
                                    + arr[p][i].name + '</span></li>';
                        if (i % rowItem == 3) {
                            buildItem += '</ul>'
                        }
                    }
                    buildItem += '</ul></div>';
                }
                return buildItem;
            },

            //- {"p":[{},{}]}
            buildSeries: function(obj, activeCode) {
                var subStr = '<div class="sub"><div class="car" data－code＝"' 
                            + activeCode + '"><span>全部车系</span></div>';
                for (var p in obj) {
                    subStr += '<div class="car-cat">'
                                + p + '</div><div class="car">';
                    var arr = obj[p];
                    for (var i = 0; i < arr.length; i++) {
                        subStr += '<span data-code="' + arr[i].code + '">' 
                                + arr[i].enName + '</span>';
                    }
                    subStr += '</div>';
                }
                subStr += '</div>';
                return subStr;
            }

        };

        var url = 'data.json';
        var brand = [], len, letter, str, i, j, brandItem, letterArr = [];
        $.getJSON(url, function(data) {
            len = data.items.length;
            for (i = 0; i < len; i++) {
                letter = data.items[i].name.substring(0, 1);
                brand[letter] = [];
                for (j = 0; j < len; j++) {
                    str = data.items[j].name.substring(0, 1);
                    brandItem = {
                        name: data.items[j].enName,
                        code:  data.items[j].code
                    }
                    if (str === letter ) {
                        brand[letter].push(brandItem);
                    }
                }
                   
            }
            
            //- 数组不使用for in
            for (var pop in brand) {
                if (brand.hasOwnProperty(pop)) {
                    var num = pop;
                }
                letterArr.push(num)
                
            }

            var brandNum = _view.buildNum(letterArr);
            var buildItem = _view.buildItem(brand);
            $('#brand-list').append(brandNum + buildItem);


            $('.brand-item').on('click', '.item', function() {
                var code = $(this).attr('data-code');
                var $this = $(this);
                var obj;
                $.ajax({
                    url: 's.json',
                    dataType: "json",
                    success: function(data) {
                        if (data) {
                            obj = data.codes;
                            $('.item').removeClass('active');
                            $this.addClass('active');
                            var subStr = _view.buildSeries(obj, code);
                            $('.brand-item .sub').remove();
                            $this.closest('.list').after(subStr);
                        }
                    }
                })
            })
            
        });

        //- var getSeriesByBrand = function (code, cb) {
        //-     $.ajax({
        //-         url: contextPath + "/pages/dicAction/loadRootLevelForCar.json",
        //-         dataType: "json",
        //-         data: {
        //-             type: "car-subdivision",
        //-             code: bCode
        //-         },
        //-         success: cb
        //-     })
        //- }



        




